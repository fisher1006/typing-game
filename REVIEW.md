# REVIEW - 儿童打字学习游戏代码审查

## 审查日期
2026-02-14

## 审查人
零号 (Zero) - 毒舌审查员

---

## 整体评价

**及格，但有不少改进空间。** 作为第一版能跑，但有些地方写得有点随意。

---

## 问题清单

### 🔴 严重问题

1. **拼音阶段逻辑有 bug**
   - 当前逻辑在 `keydown` 事件里试图同时处理输入进度，但实现混乱
   - 代码试图通过 `textContent.length` 判断进度，但这种方式在拼音阶段不可靠
   - 建议：用一个独立的变量记录用户当前输入到第几个字符

2. **键盘大写锁定没处理**
   - 如果用户开着 Caps Lock，键盘高亮和实际按键会错乱
   - 建议：监听 `CapsLock` 状态，或在游戏开始时提示关闭

### 🟡 中等问题

3. **变量命名随意**
   - `state` 对象里的字段还算清晰，但局部变量如 `data`、`opt` 太缩写
   - `pinyinData`、`charOptions` 数据结构不够统一

4. **代码重复**
   - `playSound` 里面 oscillator 创建逻辑可以抽成函数
   - `updateStats()` 可以和 `showStarPopup()` 合并

5. **硬编码拼音数据太少**
   - 目前只有 10 个词组，太少了
   - 建议：扩展到至少 50 个常用字/词

6. **难度选择没实际生效**
   - 中等和困难模式只是显示 timer，但实际上 timer 的逻辑有问题
   - `timerBar` 宽度计算在每次 `setInterval` 里重新算，太频繁

### 🟢 小问题

7. **CSS 可以更精致**
   - `.key.highlight` 的 `animation: pulse` 会一直闪，看久了眼晕
   - 建议：去掉 infinite，只闪 3 次就停下

8. **没有游戏结束/重新开始机制**
   - 用户只能一直玩下去，没有「再来一局」按钮

9. **键盘布局识别没实现**
   - PRD 里说了「自动识别键盘布局」，代码里完全没有
   - 不过这个可以后续迭代

---

## 验收情况

| 需求项 | 状态 | 备注 |
|--------|------|------|
| 三个学习阶段 | ✅ | 但拼音阶段有 bug |
| 键盘可视化提示 | ✅ | 基本实现 |
| 音效系统 | ✅ | Web Audio API 实现 |
| 星星奖励 | ✅ | |
| Combo 机制 | ✅ | |
| 三个难度 | ⚠️ | timer 逻辑有问题 |
| 卡通风格 UI | ✅ | |
| 中文界面 | ✅ | |

---

## 毒舌总结

> 这代码吧，**能跑**，但经不起细看。拼音阶段那个输入逻辑简直是灾难现场——你永远不知道用户按下去会发生什么。
> 
> 不过考虑到这是第一版，而且是我（零号）直接写的（没用到子 agent），勉强及格吧。
> 
> **建议：改完这些 bug 再给飞飞家小朋友玩，别把人家小孩搞晕了。**

---

## 后续建议

1. 修复拼音阶段输入逻辑
2. 增加更多拼音/汉字数据
3. 添加重新开始按钮
4. 优化 timer 逻辑
5. 考虑添加简单的单元测试

---

**审查结论：需要修改后复查**
